{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { Query, Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport { Banner, DisplayText, Form, FormLayout, Frame, Layout, Page, PageActions, TextField, Card, Stack, TextStyle, Checkbox, Button, Toast, SkeletonPage, SkeletonBodyText, Spinner, Loading } from \"@shopify/polaris\";\nimport { LoadingText } from \"../components/Loading\";\nimport SnippetGen from \"../components/SnippetGen\";\n\nfunction ThreekitForm(props) {\n  // Declare a new state variable, which we'll call \"count\"\n  const {\n    0: value,\n    1: setValue\n  } = useState(\"\");\n  const {\n    0: tkMetaId,\n    1: setTkMetaId\n  } = useState();\n  const {\n    0: isSaved,\n    1: setIsSaved\n  } = useState(false);\n  const {\n    0: isPdp,\n    1: setIsPdp\n  } = useState({});\n  const {\n    0: isChecked,\n    1: setIsChecked\n  } = useState(false);\n  const {\n    0: isAr,\n    1: setIsAr\n  } = useState({});\n  const {\n    0: arChecked,\n    1: setArChecked\n  } = useState(false);\n  const {\n    0: modalActive,\n    1: setModalActive\n  } = useState(false);\n  const handleModalChange = useCallback(() => setModalActive(!modalActive), [modalActive]);\n  const MAKE_TK_IMAGE = gql`\n    mutation productImageUpdate($productId: ID!, $image: ImageInput!) {\n      productImageUpdate(productId: $productId, image: $image) {\n        image {\n          id\n        }\n        userErrors {\n          field\n          message\n        }\n      }\n    }\n  `;\n  const UPDATE_TK_ID = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n  const GET_META_ID = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"assetid\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n  const IS_PLAYER_PDP = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"pdp\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n  const IS_AR_ENABLED = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"ARen\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n  const UPDATE_TK_ATTR = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n  const handleChange = useCallback(newValue => setValue(newValue), []);\n\n  const setCheck = val => setIsChecked(val);\n\n  const setArCheck = val => setArChecked(val); // const LoadingScreen = function() {\n  //   return (\n  //     <SkeletonPage primaryAction>\n  //       <SkeletonBodyText />\n  //     </SkeletonPage>\n  //   );\n  // };\n\n\n  const _createTKimage = id => {\n    // const formatId = id => id.split(\"Product/\")[1];\n    const getImgObj = id => {\n      var fetchUrl = \"/api/images/\" + id;\n      var method = \"GET\";\n      fetch(fetchUrl, {\n        method: method\n      }).then(response => response.json()).then(json => {\n        // console.log(json.data.metafields)\n        // this.setState({tkMetaId: json.data})\n        console.log(json); // setProdImg(json.data);\n      });\n    };\n\n    getImgObj(id); // isPdp ? console.log(\"Yes this is a PDP tk item\") : console.log(\"No this is not a PDP item\");\n  };\n\n  const updateMeta = (data, bool, namespace, key, obj, action) => {\n    let productVariableInput;\n\n    if (!data.product.metafield) {\n      bool ? productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"false\",\n          valueType: \"STRING\"\n        }]\n      } : productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"true\",\n          valueType: \"STRING\"\n        }]\n      };\n    } else {\n      bool ? productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"false\",\n          valueType: \"STRING\",\n          id: obj.product.metafield.id\n        }]\n      } : productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"true\",\n          valueType: \"STRING\",\n          id: obj.product.metafield.id\n        }]\n      };\n    }\n\n    action({\n      variables: {\n        input: productVariableInput\n      }\n    });\n  };\n\n  return __jsx(\"div\", null, __jsx(Stack, {\n    distribution: \"fill\"\n  }, __jsx(Form, null, __jsx(FormLayout, null, __jsx(Query, {\n    query: props.query,\n    variables: props.id\n  }, ({\n    loading,\n    error,\n    data,\n    refetch\n  }) => {\n    if (loading) return __jsx(LoadingText, null);\n    if (error) return `Error! ${error}`;\n    return __jsx(\"div\", null, __jsx(Query, {\n      query: GET_META_ID,\n      variables: props.id,\n      onCompleted: data => setTkMetaId(data)\n    }, ({\n      loading,\n      error,\n      data,\n      refetch\n    }) => {\n      if (loading) return null;\n      if (error) return `Error! ${error}`;\n      return null;\n    }), __jsx(Stack.Item, null, __jsx(\"h3\", null, __jsx(TextStyle, {\n      variation: \"strong\"\n    }, props.title))), __jsx(Stack.Item, null, __jsx(Mutation, {\n      mutation: UPDATE_TK_ID,\n      onCompleted: () => setIsSaved(true)\n    }, (handleSubmit, {\n      err,\n      res\n    }) => {\n      const showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      return __jsx(\"div\", null, !isSaved ? __jsx(\"div\", null) : __jsx(Toast, {\n        content: \"Saved\",\n        onDismiss: () => setIsSaved(false)\n      }), __jsx(Layout.Section, null, showError), __jsx(TextField, {\n        value: value,\n        onFocus: () => setValue(!data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value),\n        onChange: handleChange,\n        id: data.product.id,\n        ariaControls: data.product.id,\n        placeholder: !data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value,\n        connectedRight: __jsx(\"div\", null, __jsx(SnippetGen, {\n          handleChange: handleModalChange,\n          active: modalActive,\n          title: `${props.title}` // value={\"snippet\"}\n          ,\n          assetid: !data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value,\n          ar: \"true\",\n          env: \"preview\"\n        }), __jsx(Button, {\n          primary: true,\n          onClick: () => {\n            let productVariableInput;\n\n            if (!data.product.metafield) {\n              productVariableInput = {\n                id: props.id.id,\n                metafields: [{\n                  namespace: \"threekit\",\n                  key: \"assetid\",\n                  value: value,\n                  valueType: \"STRING\"\n                }]\n              };\n            } else {\n              productVariableInput = {\n                id: props.id.id,\n                metafields: [{\n                  namespace: \"threekit\",\n                  key: \"assetid\",\n                  value: value,\n                  valueType: \"STRING\",\n                  id: tkMetaId.product.metafield.id\n                }]\n              };\n            }\n\n            handleSubmit({\n              variables: {\n                input: productVariableInput\n              }\n            } // _createTKimage(props.id.id)\n            );\n          }\n        }, \"Save\"), __jsx(Button, {\n          onClick: handleModalChange\n        }, \"Embed this product\"))\n      }));\n    })));\n  }), __jsx(Stack.Item, null, __jsx(Query, {\n    query: IS_PLAYER_PDP,\n    variables: props.id,\n    onCompleted: data => setIsPdp(data)\n  }, ({\n    loading,\n    error,\n    data,\n    refetch\n  }) => {\n    if (loading) return __jsx(LoadingText, null);\n    if (error) return `Error! ${error}`;\n    console.log(data);\n    return __jsx(Mutation, {\n      mutation: UPDATE_TK_ATTR,\n      onCompleted: () => setIsSaved(true)\n    }, (handleSubmit, {\n      err,\n      res\n    }) => {\n      const showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      if (!data.product.metafield || data.product.metafield.value == \"false\") {\n        useEffect(() => {\n          setIsChecked(false);\n        }, [setIsChecked]);\n      } else {\n        useEffect(() => {\n          setIsChecked(true);\n        }, [setIsChecked]);\n      }\n\n      return __jsx(\"div\", null, __jsx(Checkbox, {\n        label: \"Display on PDP\",\n        checked: isChecked,\n        onChange: () => updateMeta(data, isChecked, \"threekit\", \"pdp\", isPdp, handleSubmit),\n        onFocus: () => isChecked ? setCheck(false) : setCheck(true)\n      }), isChecked ? _createTKimage(props.id) : __jsx(\"p\", null, \"not checked\"));\n    });\n  })), __jsx(Stack.Item, null, __jsx(Query, {\n    query: IS_AR_ENABLED,\n    variables: props.id,\n    onCompleted: data => setIsAr(data)\n  }, ({\n    loading,\n    error,\n    data,\n    refetch\n  }) => {\n    if (loading) return __jsx(LoadingText, null);\n    if (error) return `Error! ${error}`;\n    console.log(data);\n    return (// <div>hi</div>\n      __jsx(Mutation, {\n        mutation: UPDATE_TK_ATTR,\n        onCompleted: () => setIsSaved(true)\n      }, (handleArSubmit, {\n        err,\n        res\n      }) => {\n        const showError = err && __jsx(Banner, {\n          status: \"critical\"\n        }, err.message);\n\n        if (!data.product.metafield || data.product.metafield.value == \"false\") {\n          useEffect(() => {\n            setArChecked(false);\n          }, [setArChecked]);\n        } else {\n          useEffect(() => {\n            setArChecked(true);\n          }, [setArChecked]);\n        }\n\n        return __jsx(\"div\", null, __jsx(Checkbox, {\n          label: \"AR Enabled\",\n          checked: arChecked,\n          onChange: () => updateMeta(data, arChecked, \"threekit\", \"ARen\", isAr, handleArSubmit),\n          onFocus: () => arChecked ? setArCheck(false) : setArCheck(true)\n        }));\n      })\n    );\n  }))))));\n}\n\nexport default ThreekitForm;","map":{"version":3,"sources":["/Users/willthompson/Documents/ThreeKit/Shopify/shopify-tutorial/components/ThreekitForm.js"],"names":["React","useState","useCallback","useEffect","Query","Mutation","gql","Banner","DisplayText","Form","FormLayout","Frame","Layout","Page","PageActions","TextField","Card","Stack","TextStyle","Checkbox","Button","Toast","SkeletonPage","SkeletonBodyText","Spinner","Loading","LoadingText","SnippetGen","ThreekitForm","props","value","setValue","tkMetaId","setTkMetaId","isSaved","setIsSaved","isPdp","setIsPdp","isChecked","setIsChecked","isAr","setIsAr","arChecked","setArChecked","modalActive","setModalActive","handleModalChange","MAKE_TK_IMAGE","UPDATE_TK_ID","GET_META_ID","IS_PLAYER_PDP","IS_AR_ENABLED","UPDATE_TK_ATTR","handleChange","newValue","setCheck","val","setArCheck","_createTKimage","id","getImgObj","fetchUrl","method","fetch","then","response","json","console","log","updateMeta","data","bool","namespace","key","obj","action","productVariableInput","product","metafield","metafields","valueType","variables","input","query","loading","error","refetch","title","handleSubmit","err","res","showError","message","handleArSubmit"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport { Query, Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport {\n  Banner,\n  DisplayText,\n  Form,\n  FormLayout,\n  Frame,\n  Layout,\n  Page,\n  PageActions,\n  TextField,\n  Card,\n  Stack,\n  TextStyle,\n  Checkbox,\n  Button,\n  Toast,\n  SkeletonPage,\n  SkeletonBodyText,\n  Spinner,\n  Loading\n} from \"@shopify/polaris\";\nimport { LoadingText } from \"../components/Loading\";\nimport SnippetGen from \"../components/SnippetGen\";\n\nfunction ThreekitForm(props) {\n  // Declare a new state variable, which we'll call \"count\"\n  const [value, setValue] = useState(\"\");\n  const [tkMetaId, setTkMetaId] = useState();\n  const [isSaved, setIsSaved] = useState(false);\n\n  const [isPdp, setIsPdp] = useState({});\n  const [isChecked, setIsChecked] = useState(false);\n\n  const [isAr, setIsAr] = useState({});\n  const [arChecked, setArChecked] = useState(false);\n\n  const [modalActive, setModalActive] = useState(false);\n  const handleModalChange = useCallback(() => setModalActive(!modalActive), [\n    modalActive\n  ]);\n\n  const MAKE_TK_IMAGE = gql`\n    mutation productImageUpdate($productId: ID!, $image: ImageInput!) {\n      productImageUpdate(productId: $productId, image: $image) {\n        image {\n          id\n        }\n        userErrors {\n          field\n          message\n        }\n      }\n    }\n  `;\n\n  const UPDATE_TK_ID = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n\n  const GET_META_ID = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"assetid\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const IS_PLAYER_PDP = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"pdp\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const IS_AR_ENABLED = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"ARen\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const UPDATE_TK_ATTR = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n\n  const handleChange = useCallback(newValue => setValue(newValue), []);\n\n  const setCheck = val => setIsChecked(val);\n  const setArCheck = val => setArChecked(val);\n\n  // const LoadingScreen = function() {\n  //   return (\n  //     <SkeletonPage primaryAction>\n  //       <SkeletonBodyText />\n  //     </SkeletonPage>\n  //   );\n  // };\n\n  const _createTKimage = id => {\n    // const formatId = id => id.split(\"Product/\")[1];\n\n    const getImgObj = id => {\n      var fetchUrl = \"/api/images/\" + id;\n      var method = \"GET\";\n      fetch(fetchUrl, { method: method })\n        .then(response => response.json())\n        .then(json => {\n          // console.log(json.data.metafields)\n          // this.setState({tkMetaId: json.data})\n          console.log(json);\n          // setProdImg(json.data);\n        });\n    };\n    getImgObj(id);\n    // isPdp ? console.log(\"Yes this is a PDP tk item\") : console.log(\"No this is not a PDP item\");\n  };\n  \n\n  const updateMeta = (data, bool, namespace, key, obj, action) => {\n    let productVariableInput;\n    if (!data.product.metafield) {\n      bool\n        ? (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"false\",\n                valueType: \"STRING\"\n              }\n            ]\n          })\n        : (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"true\",\n                valueType: \"STRING\"\n              }\n            ]\n          });\n    } else {\n      bool\n        ? (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"false\",\n                valueType: \"STRING\",\n                id: obj.product.metafield.id\n              }\n            ]\n          })\n        : (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"true\",\n                valueType: \"STRING\",\n                id: obj.product.metafield.id\n              }\n            ]\n          });\n    }\n\n    action({\n      variables: {\n        input: productVariableInput\n      }\n    });\n  };\n  return (\n    <div>\n      <Stack distribution=\"fill\">\n        <Form>\n          <FormLayout>\n            {/* <FormLayout.Group> */}\n            <Query query={props.query} variables={props.id}>\n              {({ loading, error, data, refetch }) => {\n                if (loading) return <LoadingText />;\n                if (error) return `Error! ${error}`;\n\n                return (\n                  <div>\n                    <Query\n                      query={GET_META_ID}\n                      variables={props.id}\n                      onCompleted={data => setTkMetaId(data)}\n                    >\n                      {({ loading, error, data, refetch }) => {\n                        if (loading) return null;\n                        if (error) return `Error! ${error}`;\n\n                        return null;\n                      }}\n                    </Query>\n\n                    <Stack.Item>\n                      <h3>\n                        <TextStyle variation=\"strong\">{props.title}</TextStyle>\n                      </h3>\n                    </Stack.Item>\n\n                    <Stack.Item>\n                      <Mutation\n                        mutation={UPDATE_TK_ID}\n                        onCompleted={() => setIsSaved(true)}\n                      >\n                        {(handleSubmit, { err, res }) => {\n                          const showError = err && (\n                            <Banner status=\"critical\">{err.message}</Banner>\n                          );\n\n                          return (\n                            <div>\n                              {/* <Frame> */}\n                              {/* <Page> */}\n                              {/* <Layout> */}\n                              {!isSaved ? (\n                                <div></div>\n                              ) : (\n                                <Toast\n                                  content=\"Saved\"\n                                  onDismiss={() => setIsSaved(false)}\n                                ></Toast>\n                              )}\n\n                              <Layout.Section>{showError}</Layout.Section>\n                              {/* <Layout.Section> */}\n\n                              <TextField\n                                value={value}\n                                onFocus={() =>\n                                  setValue(\n                                    !data.product.metafield\n                                      ? \"No Threekit ID\"\n                                      : data.product.metafield.value\n                                  )\n                                }\n                                onChange={handleChange}\n                                id={data.product.id}\n                                ariaControls={data.product.id}\n                                placeholder={\n                                  !data.product.metafield\n                                    ? \"No Threekit ID\"\n                                    : data.product.metafield.value\n                                }\n                                connectedRight={\n                                  <div>\n                                    <SnippetGen\n                                      handleChange={handleModalChange}\n                                      active={modalActive}\n                                      title={`${props.title}`}\n                                      // value={\"snippet\"}\n                                      assetid={\n                                        !data.product.metafield\n                                          ? \"No Threekit ID\"\n                                          : data.product.metafield.value\n                                      }\n                                      ar={\"true\"}\n                                      env={\"preview\"}\n                                    />\n                                    <Button\n                                      primary\n                                      onClick={() => {\n                                        let productVariableInput;\n                                        if (!data.product.metafield) {\n                                          productVariableInput = {\n                                            id: props.id.id,\n                                            metafields: [\n                                              {\n                                                namespace: \"threekit\",\n                                                key: \"assetid\",\n                                                value: value,\n                                                valueType: \"STRING\"\n                                              }\n                                            ]\n                                          };\n                                        } else {\n                                          productVariableInput = {\n                                            id: props.id.id,\n                                            metafields: [\n                                              {\n                                                namespace: \"threekit\",\n                                                key: \"assetid\",\n                                                value: value,\n                                                valueType: \"STRING\",\n                                                id:\n                                                  tkMetaId.product.metafield.id\n                                              }\n                                            ]\n                                          };\n                                        }\n\n                                        handleSubmit(\n                                          {\n                                            variables: {\n                                              input: productVariableInput\n                                            }\n                                          }\n\n                                          // _createTKimage(props.id.id)\n                                        );\n                                      }}\n                                    >\n                                      Save\n                                    </Button>\n                                    <Button onClick={handleModalChange}>\n                                      Embed this product\n                                    </Button>\n                                  </div>\n                                }\n                              ></TextField>\n\n                              {/* </Page> */}\n                              {/* </Frame> */}\n                            </div>\n                          );\n                        }}\n                      </Mutation>\n                    </Stack.Item>\n                  </div>\n                );\n              }}\n            </Query>\n\n            <Stack.Item>\n              <Query\n                query={IS_PLAYER_PDP}\n                variables={props.id}\n                onCompleted={data => setIsPdp(data)}\n              >\n                {({ loading, error, data, refetch }) => {\n                  if (loading) return <LoadingText />;\n                  if (error) return `Error! ${error}`;\n                  console.log(data);\n                  return (\n                    <Mutation\n                      mutation={UPDATE_TK_ATTR}\n                      onCompleted={() => setIsSaved(true)}\n                    >\n                      {(handleSubmit, { err, res }) => {\n                        const showError = err && (\n                          <Banner status=\"critical\">{err.message}</Banner>\n                        );\n                        if (\n                          !data.product.metafield ||\n                          data.product.metafield.value == \"false\"\n                        ) {\n                          useEffect(() => {\n                            setIsChecked(false);\n                          }, [setIsChecked]);\n                        } else {\n                          useEffect(() => {\n                            setIsChecked(true);\n                          }, [setIsChecked]);\n                        }\n\n                        return (\n                          <div>\n                            <Checkbox\n                              label=\"Display on PDP\"\n                              checked={isChecked}\n                              onChange={() =>\n                                updateMeta(\n                                  data,\n                                  isChecked,\n                                  \"threekit\",\n                                  \"pdp\",\n                                  isPdp,\n                                  handleSubmit\n                                )\n                              }\n                              onFocus={() =>\n                                isChecked ? setCheck(false) : setCheck(true)\n                              }\n                            />\n                            {isChecked ? (\n                              _createTKimage(props.id)\n                            ) : (\n                              <p>not checked</p>\n                            )}\n                          </div>\n                        );\n                      }}\n                    </Mutation>\n                  );\n                }}\n              </Query>\n            </Stack.Item>\n            <Stack.Item>\n              <Query\n                query={IS_AR_ENABLED}\n                variables={props.id}\n                onCompleted={data => setIsAr(data)}\n              >\n                {({ loading, error, data, refetch }) => {\n                  if (loading) return <LoadingText />;\n                  if (error) return `Error! ${error}`;\n                  console.log(data);\n                  return (\n                    // <div>hi</div>\n                    <Mutation\n                      mutation={UPDATE_TK_ATTR}\n                      onCompleted={() => setIsSaved(true)}\n                    >\n                      {(handleArSubmit, { err, res }) => {\n                        const showError = err && (\n                          <Banner status=\"critical\">{err.message}</Banner>\n                        );\n                        if (\n                          !data.product.metafield ||\n                          data.product.metafield.value == \"false\"\n                        ) {\n                          useEffect(() => {\n                            setArChecked(false);\n                          }, [setArChecked]);\n                        } else {\n                          useEffect(() => {\n                            setArChecked(true);\n                          }, [setArChecked]);\n                        }\n\n                        return (\n                          <div>\n                            <Checkbox\n                              label=\"AR Enabled\"\n                              checked={arChecked}\n                              onChange={() =>\n                                updateMeta(\n                                  data,\n                                  arChecked,\n                                  \"threekit\",\n                                  \"ARen\",\n                                  isAr,\n                                  handleArSubmit\n                                )\n                              }\n                              onFocus={() =>\n                                arChecked ? setArCheck(false) : setArCheck(true)\n                              }\n                            />\n                          </div>\n                        );\n                      }}\n                    </Mutation>\n                  );\n                }}\n              </Query>\n            </Stack.Item>\n            {/* </FormLayout.Group> */}\n          </FormLayout>\n        </Form>\n      </Stack>\n    </div>\n  );\n}\n\nexport default ThreekitForm;\n"]},"metadata":{},"sourceType":"module"}