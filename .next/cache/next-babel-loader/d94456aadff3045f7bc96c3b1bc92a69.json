{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { Query, Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport { Banner, DisplayText, Form, FormLayout, Frame, Layout, Page, PageActions, TextField, Card, Stack, TextStyle, Checkbox, Button, Toast } from \"@shopify/polaris\";\n\nfunction ThreekitForm(props) {\n  // Declare a new state variable, which we'll call \"count\"\n  const {\n    0: value,\n    1: setValue\n  } = useState(\"\");\n  const {\n    0: tkMetaId,\n    1: setTkMetaId\n  } = useState();\n  const {\n    0: isSaved,\n    1: setIsSaved\n  } = useState(false);\n  const {\n    0: isPdp,\n    1: setIsPdp\n  } = useState({});\n  const {\n    0: isPdpChecked,\n    1: setisPdpChecked\n  } = useState(false);\n  const UPDATE_TK_ID = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n  const GET_META_ID = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"assetid\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n  const IS_PLAYER_PDP = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"pdp\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n  const IS_AR_ENABLED = gql`\n  query($id: ID!) {\n    product(id: $id) {\n      metafield(namespace: \"threekit\", key: \"pdp\") {\n        value\n        id\n      }\n    }\n  }\n`;\n  const UPDATE_TK_ATTR = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n  const handleChange = useCallback(newValue => setValue(newValue), []);\n\n  const setCheck = val => setisPdpChecked(val);\n\n  const _createTKimage = id => {\n    const formatId = id => id.split(\"Product/\")[1];\n\n    const getImgObj = id => {\n      var fetchUrl = \"/api/images/\" + formatId(id);\n      var method = \"GET\";\n      fetch(fetchUrl, {\n        method: method\n      }).then(response => response.json()).then(json => {\n        // console.log(json.data.metafields)\n        // this.setState({tkMetaId: json.data})\n        console.log(json); // setProdImg(json.data);\n      });\n    };\n\n    getImgObj(id); // isPdp ? console.log(\"Yes this is a PDP tk item\") : console.log(\"No this is not a PDP item\");\n  };\n\n  return __jsx(\"div\", null, __jsx(Stack, null, __jsx(Query, {\n    query: props.query,\n    variables: props.id\n  }, ({\n    loading,\n    error,\n    data,\n    refetch\n  }) => {\n    if (loading) return null;\n    if (error) return `Error! ${error}`;\n    return __jsx(\"div\", null, __jsx(Query, {\n      query: GET_META_ID,\n      variables: props.id,\n      onCompleted: data => setTkMetaId(data)\n    }, ({\n      loading,\n      error,\n      data,\n      refetch\n    }) => {\n      if (loading) return null;\n      if (error) return `Error! ${error}`;\n      return null;\n    }), __jsx(Stack.Item, {\n      fill: true\n    }, __jsx(\"h3\", null, __jsx(TextStyle, {\n      variation: \"strong\"\n    }, props.title))), __jsx(Stack.Item, null, __jsx(Mutation, {\n      mutation: UPDATE_TK_ID,\n      onCompleted: () => setIsSaved(true)\n    }, (handleSubmit, {\n      err,\n      res\n    }) => {\n      const showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      return __jsx(\"div\", null, __jsx(Page, null, !isSaved ? __jsx(\"div\", null) : __jsx(Toast, {\n        content: \"Saved\",\n        onDismiss: () => setIsSaved(false)\n      }), __jsx(Layout.Section, null, showError), __jsx(Form, null, __jsx(FormLayout, null, __jsx(FormLayout.Group, null, __jsx(TextField, {\n        value: value,\n        onFocus: () => setValue(!data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value),\n        onChange: handleChange,\n        id: data.product.id,\n        ariaControls: data.product.id,\n        placeholder: !data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value,\n        connectedRight: __jsx(Button, {\n          onClick: () => {\n            let productVariableInput;\n\n            if (!data.product.metafield) {\n              productVariableInput = {\n                id: props.id.id,\n                metafields: [{\n                  namespace: \"threekit\",\n                  key: \"assetid\",\n                  value: value,\n                  valueType: \"STRING\"\n                }]\n              };\n            } else {\n              productVariableInput = {\n                id: props.id.id,\n                metafields: [{\n                  namespace: \"threekit\",\n                  key: \"assetid\",\n                  value: value,\n                  valueType: \"STRING\",\n                  id: tkMetaId.product.metafield.id\n                }]\n              };\n            }\n\n            handleSubmit({\n              variables: {\n                input: productVariableInput\n              }\n            } // _createTKimage(props.id.id)\n            );\n          }\n        }, \"Save\")\n      }))))));\n    })));\n  }), __jsx(Stack.Item, null, __jsx(Query, {\n    query: IS_PLAYER_PDP,\n    variables: props.id,\n    onCompleted: data => setIsPdp(data)\n  }, ({\n    loading,\n    error,\n    data,\n    refetch\n  }) => {\n    if (loading) return null;\n    if (error) return `Error! ${error}`;\n    console.log(data);\n    return __jsx(Mutation, {\n      mutation: UPDATE_TK_ATTR,\n      onCompleted: () => setIsSaved(true)\n    }, (handleSubmit, {\n      err,\n      res\n    }) => {\n      const showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      if (!data.product.metafield || data.product.metafield.value == \"false\") {\n        useEffect(() => {\n          setisPdpChecked(false);\n        }, [setisPdpChecked]);\n      } else {\n        useEffect(() => {\n          setisPdpChecked(true);\n        }, [setisPdpChecked]);\n      }\n\n      return __jsx(\"div\", null, __jsx(Checkbox, {\n        label: \"Display on PDP\",\n        checked: isPdpChecked,\n        onChange: () => {\n          let productVariableInput;\n\n          if (!data.product.metafield) {\n            isPdpChecked ? productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"false\",\n                valueType: \"STRING\"\n              }]\n            } : productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"true\",\n                valueType: \"STRING\"\n              }]\n            };\n          } else {\n            isPdpChecked ? productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"false\",\n                valueType: \"STRING\",\n                id: isPdp.product.metafield.id\n              }]\n            } : productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"true\",\n                valueType: \"STRING\",\n                id: isPdp.product.metafield.id\n              }]\n            };\n          }\n\n          handleSubmit({\n            variables: {\n              input: productVariableInput\n            }\n          });\n        } //\n        ,\n        onFocus: () => isPdpChecked ? setCheck(false) : setCheck(true)\n      }));\n    });\n  })), __jsx(Stack.Item, null, isChecked ? __jsx(Query, {\n    query: IS_AR_ENABLED,\n    variables: props.id,\n    onCompleted: data => setIsPdp(data)\n  }, ({\n    loading,\n    error,\n    data,\n    refetch\n  }) => {\n    if (loading) return null;\n    if (error) return `Error! ${error}`;\n    console.log(data);\n    return __jsx(Mutation, {\n      mutation: UPDATE_TK_ATTR,\n      onCompleted: () => setIsSaved(true)\n    }, (handleSubmit, {\n      err,\n      res\n    }) => {\n      const showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      if (!data.product.metafield || data.product.metafield.value == \"false\") {\n        useEffect(() => {\n          setIsChecked(false);\n        }, [setIsChecked]);\n      } else {\n        useEffect(() => {\n          setIsChecked(true);\n        }, [setIsChecked]);\n      }\n\n      return __jsx(\"div\", null, __jsx(Checkbox, {\n        label: \"Display on PDP\",\n        checked: isChecked,\n        onChange: () => {\n          let productVariableInput;\n\n          if (!data.product.metafield) {\n            isChecked ? productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"false\",\n                valueType: \"STRING\"\n              }]\n            } : productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"true\",\n                valueType: \"STRING\"\n              }]\n            };\n          } else {\n            isChecked ? productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"false\",\n                valueType: \"STRING\",\n                id: isPdp.product.metafield.id\n              }]\n            } : productVariableInput = {\n              id: props.id.id,\n              metafields: [{\n                namespace: \"threekit\",\n                key: \"pdp\",\n                value: \"true\",\n                valueType: \"STRING\",\n                id: isPdp.product.metafield.id\n              }]\n            };\n          }\n\n          handleSubmit({\n            variables: {\n              input: productVariableInput\n            }\n          });\n        } //\n        ,\n        onFocus: () => isChecked ? setCheck(false) : setCheck(true)\n      }));\n    });\n  }) : \"\")));\n}\n\nexport default ThreekitForm;","map":{"version":3,"sources":["/Users/willthompson/Documents/ThreeKit/Shopify/shopify-tutorial/components/ThreekitForm.js"],"names":["React","useState","useCallback","useEffect","Query","Mutation","gql","Banner","DisplayText","Form","FormLayout","Frame","Layout","Page","PageActions","TextField","Card","Stack","TextStyle","Checkbox","Button","Toast","ThreekitForm","props","value","setValue","tkMetaId","setTkMetaId","isSaved","setIsSaved","isPdp","setIsPdp","isPdpChecked","setisPdpChecked","UPDATE_TK_ID","GET_META_ID","IS_PLAYER_PDP","IS_AR_ENABLED","UPDATE_TK_ATTR","handleChange","newValue","setCheck","val","_createTKimage","id","formatId","split","getImgObj","fetchUrl","method","fetch","then","response","json","console","log","query","loading","error","data","refetch","title","handleSubmit","err","res","showError","message","product","metafield","productVariableInput","metafields","namespace","key","valueType","variables","input","isChecked","setIsChecked"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport { Query, Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport {\n  Banner,\n  DisplayText,\n  Form,\n  FormLayout,\n  Frame,\n  Layout,\n  Page,\n  PageActions,\n  TextField,\n  Card,\n  Stack,\n  TextStyle,\n  Checkbox,\n  Button,\n  Toast\n} from \"@shopify/polaris\";\n\nfunction ThreekitForm(props) {\n  // Declare a new state variable, which we'll call \"count\"\n  const [value, setValue] = useState(\"\");\n  const [tkMetaId, setTkMetaId] = useState();\n  const [isSaved, setIsSaved] = useState(false);\n  const [isPdp, setIsPdp] = useState({});\n  const [isPdpChecked, setisPdpChecked] = useState(false);\n\n\n  const UPDATE_TK_ID = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n \n\n  const GET_META_ID = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"assetid\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const IS_PLAYER_PDP = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"pdp\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const IS_AR_ENABLED = gql`\n  query($id: ID!) {\n    product(id: $id) {\n      metafield(namespace: \"threekit\", key: \"pdp\") {\n        value\n        id\n      }\n    }\n  }\n`;\n\n  const UPDATE_TK_ATTR = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n\n  const handleChange = useCallback(newValue => setValue(newValue), []);\n  const setCheck = val => setisPdpChecked(val);\n\n  const _createTKimage = id => {\n    const formatId = id => id.split(\"Product/\")[1];\n\n    const getImgObj = id => {\n      var fetchUrl = \"/api/images/\" + formatId(id);\n      var method = \"GET\";\n      fetch(fetchUrl, { method: method })\n        .then(response => response.json())\n        .then(json => {\n          // console.log(json.data.metafields)\n          // this.setState({tkMetaId: json.data})\n          console.log(json);\n          // setProdImg(json.data);\n        });\n    };\n    getImgObj(id);\n    // isPdp ? console.log(\"Yes this is a PDP tk item\") : console.log(\"No this is not a PDP item\");\n  };\n\n  return (\n    <div>\n      <Stack>\n        <Query query={props.query} variables={props.id}>\n          {({ loading, error, data, refetch }) => {\n            if (loading) return null;\n            if (error) return `Error! ${error}`;\n\n            return (\n              <div>\n                <Query\n                  query={GET_META_ID}\n                  variables={props.id}\n                  onCompleted={data => setTkMetaId(data)}\n                >\n                  {({ loading, error, data, refetch }) => {\n                    if (loading) return null;\n                    if (error) return `Error! ${error}`;\n\n                    return null;\n                  }}\n                </Query>\n\n                <Stack.Item fill>\n                  <h3>\n                    <TextStyle variation=\"strong\">{props.title}</TextStyle>\n                  </h3>\n                </Stack.Item>\n\n                <Stack.Item>\n                  <Mutation mutation={UPDATE_TK_ID} onCompleted={() => setIsSaved(true)}>\n                    {(handleSubmit, { err, res }) => {\n                      const showError = err && (\n                        <Banner status=\"critical\">{err.message}</Banner>\n                      );\n\n                      return (\n                        <div>\n                          {/* <Frame> */}\n                          <Page>\n                            {/* <Layout> */}\n                            {!isSaved ? (\n                              <div></div>\n                            ) : (\n                              <Toast\n                                content=\"Saved\"\n                                onDismiss={() => setIsSaved(false)}\n                              >\n       \n                              </Toast>\n                            )}\n\n                            <Layout.Section>{showError}</Layout.Section>\n                            {/* <Layout.Section> */}\n\n                            <Form>\n                              <FormLayout>\n                                <FormLayout.Group>\n                                  <TextField\n                                    value={value}\n                                    onFocus={() =>\n                                      setValue(\n                                        !data.product.metafield\n                                          ? \"No Threekit ID\"\n                                          : data.product.metafield.value\n                                      )\n                                    }\n                                    onChange={handleChange}\n                                    id={data.product.id}\n                                    ariaControls={data.product.id}\n                                    placeholder={\n                                      !data.product.metafield\n                                        ? \"No Threekit ID\"\n                                        : data.product.metafield.value\n                                    }\n                                    connectedRight={\n                                      <Button\n                                        onClick={() => {\n                                          let productVariableInput;\n                                          if (!data.product.metafield) {\n                                            productVariableInput = {\n                                              id: props.id.id,\n                                              metafields: [\n                                                {\n                                                  namespace: \"threekit\",\n                                                  key: \"assetid\",\n                                                  value: value,\n                                                  valueType: \"STRING\"\n                                                }\n                                              ]\n                                            };\n                                          } else {\n                                            productVariableInput = {\n                                              id: props.id.id,\n                                              metafields: [\n                                                {\n                                                  namespace: \"threekit\",\n                                                  key: \"assetid\",\n                                                  value: value,\n                                                  valueType: \"STRING\",\n                                                  id:\n                                                    tkMetaId.product.metafield\n                                                      .id\n                                                }\n                                              ]\n                                            };\n                                          }\n\n                                          handleSubmit(\n                                            {\n                                              variables: {\n                                                input: productVariableInput\n                                              }\n                                            },\n                                            \n                                            // _createTKimage(props.id.id)\n                                          );\n                                        }}\n                                      >\n                                        Save\n                                      </Button>\n                                    }\n                                  ></TextField>\n                                </FormLayout.Group>\n                              </FormLayout>\n                            </Form>\n                          </Page>\n                          {/* </Frame> */}\n                        </div>\n                      );\n                    }}\n                  </Mutation>\n                </Stack.Item>\n              </div>\n            );\n          }}\n        </Query>\n        <Stack.Item>\n          <Query\n            query={IS_PLAYER_PDP}\n            variables={props.id}\n            onCompleted={data => setIsPdp(data)}\n          >\n            {({ loading, error, data, refetch }) => {\n              if (loading) return null;\n              if (error) return `Error! ${error}`;\n              console.log(data);\n              return (\n                <Mutation mutation={UPDATE_TK_ATTR} onCompleted={() => setIsSaved(true)}>\n                  {(handleSubmit, { err, res }) => {\n                    const showError = err && (\n                      <Banner status=\"critical\">{err.message}</Banner>\n                    );\n                    if (\n                      !data.product.metafield ||\n                      data.product.metafield.value == \"false\"\n                    ) {\n                      useEffect(() => {\n                        setisPdpChecked(false);\n                      }, [setisPdpChecked]);\n                    } else {\n                      useEffect(() => {\n                        setisPdpChecked(true);\n                      }, [setisPdpChecked]);\n                    }\n\n                    return (\n                      <div>\n                      \n                        <Checkbox\n                          label=\"Display on PDP\"\n                          checked={isPdpChecked}\n                          onChange={() => {\n                            let productVariableInput;\n                            if (!data.product.metafield) {\n                              isPdpChecked\n                                ? (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"false\",\n                                        valueType: \"STRING\"\n                                      }\n                                    ]\n                                  })\n                                : (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"true\",\n                                        valueType: \"STRING\"\n                                      }\n                                    ]\n                                  });\n                            } else {\n                              isPdpChecked\n                                ? (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"false\",\n                                        valueType: \"STRING\",\n                                        id: isPdp.product.metafield.id\n                                      }\n                                    ]\n                                  })\n                                : (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"true\",\n                                        valueType: \"STRING\",\n                                        id: isPdp.product.metafield.id\n                                      }\n                                    ]\n                                  });\n                            }\n\n                            handleSubmit({\n                              variables: {\n                                input: productVariableInput\n                              }\n                            });\n                          }}\n                          //\n                          onFocus={() =>\n                            isPdpChecked ? setCheck(false) : setCheck(true)\n                          }\n                        />\n                      </div>\n                    );\n                  }}\n                </Mutation>\n              );\n            }}\n          </Query>\n        </Stack.Item>\n        <Stack.Item>\n          {isChecked ? (\n            <Query\n            query={IS_AR_ENABLED}\n            variables={props.id}\n            onCompleted={data => setIsPdp(data)}\n          >\n            {({ loading, error, data, refetch }) => {\n              if (loading) return null;\n              if (error) return `Error! ${error}`;\n              console.log(data);\n              return (\n                <Mutation mutation={UPDATE_TK_ATTR} onCompleted={() => setIsSaved(true)}>\n                  {(handleSubmit, { err, res }) => {\n                    const showError = err && (\n                      <Banner status=\"critical\">{err.message}</Banner>\n                    );\n                    if (\n                      !data.product.metafield ||\n                      data.product.metafield.value == \"false\"\n                    ) {\n                      useEffect(() => {\n                        setIsChecked(false);\n                      }, [setIsChecked]);\n                    } else {\n                      useEffect(() => {\n                        setIsChecked(true);\n                      }, [setIsChecked]);\n                    }\n\n                    return (\n                      <div>\n                      \n                        <Checkbox\n                          label=\"Display on PDP\"\n                          checked={isChecked}\n                          onChange={() => {\n                            let productVariableInput;\n                            if (!data.product.metafield) {\n                              isChecked\n                                ? (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"false\",\n                                        valueType: \"STRING\"\n                                      }\n                                    ]\n                                  })\n                                : (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"true\",\n                                        valueType: \"STRING\"\n                                      }\n                                    ]\n                                  });\n                            } else {\n                              isChecked\n                                ? (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"false\",\n                                        valueType: \"STRING\",\n                                        id: isPdp.product.metafield.id\n                                      }\n                                    ]\n                                  })\n                                : (productVariableInput = {\n                                    id: props.id.id,\n                                    metafields: [\n                                      {\n                                        namespace: \"threekit\",\n                                        key: \"pdp\",\n                                        value: \"true\",\n                                        valueType: \"STRING\",\n                                        id: isPdp.product.metafield.id\n                                      }\n                                    ]\n                                  });\n                            }\n\n                            handleSubmit({\n                              variables: {\n                                input: productVariableInput\n                              }\n                            });\n                          }}\n                          //\n                          onFocus={() =>\n                            isChecked ? setCheck(false) : setCheck(true)\n                          }\n                        />\n                      </div>\n                    );\n                  }}\n                </Mutation>\n              );\n            }}\n          </Query>\n          ) : \"\"}\n        </Stack.Item>\n      </Stack>\n    </div>\n  );\n}\n\nexport default ThreekitForm;\n"]},"metadata":{},"sourceType":"module"}