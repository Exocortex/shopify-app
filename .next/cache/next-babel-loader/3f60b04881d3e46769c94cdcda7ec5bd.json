{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar __jsx = React.createElement;\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n    mutation($input: ProductInput!) {\\n      productUpdate(input: $input) {\\n        product {\\n          metafields(first: 100) {\\n            edges {\\n              node {\\n                id\\n                namespace\\n                key\\n                value\\n              }\\n            }\\n          }\\n        }\\n      }\\n    }\\n  \"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n    query($id: ID!) {\\n      product(id: $id) {\\n        metafield(namespace: \\\"threekit\\\", key: \\\"ARen\\\") {\\n          value\\n          id\\n        }\\n      }\\n    }\\n  \"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    query($id: ID!) {\\n      product(id: $id) {\\n        metafield(namespace: \\\"threekit\\\", key: \\\"pdp\\\") {\\n          value\\n          id\\n        }\\n      }\\n    }\\n  \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    query($id: ID!) {\\n      product(id: $id) {\\n        metafield(namespace: \\\"threekit\\\", key: \\\"assetid\\\") {\\n          value\\n          id\\n        }\\n      }\\n    }\\n  \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    mutation($input: ProductInput!) {\\n      productUpdate(input: $input) {\\n        product {\\n          metafields(first: 100) {\\n            edges {\\n              node {\\n                id\\n                namespace\\n                key\\n                value\\n              }\\n            }\\n          }\\n        }\\n      }\\n    }\\n  \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { Query, Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport { Banner, Form, FormLayout, Layout, TextField, Stack, TextStyle, Checkbox, Button, Toast } from \"@shopify/polaris\";\nimport { LoadingText } from \"../components/Loading\";\nimport SnippetGen from \"../components/SnippetGen\";\n\nfunction ThreekitForm(props) {\n  // Declare a new state variable, which we'll call \"count\"\n  var _useState = useState(\"\"),\n      value = _useState[0],\n      setValue = _useState[1];\n\n  var _useState2 = useState(),\n      tkMetaId = _useState2[0],\n      setTkMetaId = _useState2[1];\n\n  var _useState3 = useState(false),\n      isSaved = _useState3[0],\n      setIsSaved = _useState3[1];\n\n  var _useState4 = useState({}),\n      isPdp = _useState4[0],\n      setIsPdp = _useState4[1];\n\n  var _useState5 = useState(false),\n      isChecked = _useState5[0],\n      setIsChecked = _useState5[1];\n\n  var _useState6 = useState({}),\n      isAr = _useState6[0],\n      setIsAr = _useState6[1];\n\n  var _useState7 = useState(false),\n      arChecked = _useState7[0],\n      setArChecked = _useState7[1];\n\n  var _useState8 = useState(false),\n      modalActive = _useState8[0],\n      setModalActive = _useState8[1];\n\n  var handleModalChange = useCallback(function () {\n    return setModalActive(!modalActive);\n  }, [modalActive]);\n  var UPDATE_TK_ID = gql(_templateObject());\n  var GET_META_ID = gql(_templateObject2());\n  var IS_PLAYER_PDP = gql(_templateObject3());\n  var IS_AR_ENABLED = gql(_templateObject4());\n  var UPDATE_TK_ATTR = gql(_templateObject5());\n  var handleChange = useCallback(function (newValue) {\n    return setValue(newValue);\n  }, []);\n\n  var setCheck = function setCheck(val) {\n    return setIsChecked(val);\n  };\n\n  var setArCheck = function setArCheck(val) {\n    return setArChecked(val);\n  };\n\n  var updateMeta = function updateMeta(data, bool, namespace, key, obj, action) {\n    var productVariableInput;\n\n    if (!data.product.metafield) {\n      bool ? productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"false\",\n          valueType: \"STRING\"\n        }]\n      } : productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"true\",\n          valueType: \"STRING\"\n        }]\n      };\n    } else {\n      bool ? productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"false\",\n          valueType: \"STRING\",\n          id: obj.product.metafield.id\n        }]\n      } : productVariableInput = {\n        id: props.id.id,\n        metafields: [{\n          namespace: namespace,\n          key: key,\n          value: \"true\",\n          valueType: \"STRING\",\n          id: obj.product.metafield.id\n        }]\n      };\n    }\n\n    action({\n      variables: {\n        input: productVariableInput\n      }\n    });\n  };\n\n  return __jsx(\"div\", null, __jsx(Stack, {\n    distribution: \"fill\"\n  }, __jsx(Form, null, __jsx(FormLayout, null, __jsx(Query, {\n    query: props.query,\n    variables: props.id\n  }, function (_ref) {\n    var loading = _ref.loading,\n        error = _ref.error,\n        data = _ref.data,\n        refetch = _ref.refetch;\n    if (loading) return __jsx(LoadingText, null);\n    if (error) return \"Error! \".concat(error);\n    return __jsx(\"div\", null, __jsx(Query, {\n      query: GET_META_ID,\n      variables: props.id,\n      onCompleted: function onCompleted(data) {\n        return setTkMetaId(data);\n      }\n    }, function (_ref2) {\n      var loading = _ref2.loading,\n          error = _ref2.error,\n          data = _ref2.data,\n          refetch = _ref2.refetch;\n      if (loading) return null;\n      if (error) return \"Error! \".concat(error);\n      return null;\n    }), __jsx(Stack.Item, null, __jsx(\"h3\", null, __jsx(TextStyle, {\n      variation: \"strong\"\n    }, props.title))), __jsx(Stack.Item, null, __jsx(Mutation, {\n      mutation: UPDATE_TK_ID,\n      onCompleted: function onCompleted() {\n        return setIsSaved(true);\n      }\n    }, function (handleSubmit, _ref3) {\n      var err = _ref3.err,\n          res = _ref3.res;\n\n      var showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      return __jsx(\"div\", null, !isSaved ? __jsx(\"div\", null) : __jsx(Toast, {\n        content: \"Saved\",\n        onDismiss: function onDismiss() {\n          return setIsSaved(false);\n        }\n      }), __jsx(Layout.Section, null, showError), __jsx(TextField, {\n        value: value,\n        onFocus: function onFocus() {\n          return setValue(!data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value);\n        },\n        onChange: handleChange,\n        id: data.product.id,\n        ariaControls: data.product.id,\n        placeholder: !data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value,\n        connectedRight: __jsx(\"div\", null, __jsx(SnippetGen, {\n          handleChange: handleModalChange,\n          active: modalActive,\n          title: \"\".concat(props.title),\n          assetid: !data.product.metafield ? \"No Threekit ID\" : data.product.metafield.value,\n          ar: \"true\",\n          env: \"preview\"\n        }), __jsx(Button, {\n          primary: true,\n          onClick: function onClick() {\n            var productVariableInput;\n\n            if (!data.product.metafield) {\n              productVariableInput = {\n                id: props.id.id,\n                metafields: [{\n                  namespace: \"threekit\",\n                  key: \"assetid\",\n                  value: value,\n                  valueType: \"STRING\"\n                }]\n              };\n            } else {\n              productVariableInput = {\n                id: props.id.id,\n                metafields: [{\n                  namespace: \"threekit\",\n                  key: \"assetid\",\n                  value: value,\n                  valueType: \"STRING\",\n                  id: tkMetaId.product.metafield.id\n                }]\n              };\n            }\n\n            handleSubmit({\n              variables: {\n                input: productVariableInput\n              }\n            });\n          }\n        }, \"Save\"), __jsx(Button, {\n          onClick: handleModalChange\n        }, \"Embed this product\"))\n      }));\n    })));\n  }), __jsx(Stack.Item, null, __jsx(Query, {\n    query: IS_PLAYER_PDP,\n    variables: props.id,\n    onCompleted: function onCompleted(data) {\n      return setIsPdp(data);\n    }\n  }, function (_ref4) {\n    var loading = _ref4.loading,\n        error = _ref4.error,\n        data = _ref4.data,\n        refetch = _ref4.refetch;\n    if (loading) return __jsx(LoadingText, null);\n    if (error) return \"Error! \".concat(error);\n    console.log(data);\n    return __jsx(Mutation, {\n      mutation: UPDATE_TK_ATTR,\n      onCompleted: function onCompleted() {\n        return setIsSaved(true);\n      }\n    }, function (handleSubmit, _ref5) {\n      var err = _ref5.err,\n          res = _ref5.res;\n\n      var showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      if (!data.product.metafield || data.product.metafield.value == \"false\") {\n        useEffect(function () {\n          setIsChecked(false);\n        }, [setIsChecked]);\n      } else {\n        useEffect(function () {\n          setIsChecked(true);\n        }, [setIsChecked]);\n      }\n\n      return __jsx(\"div\", null, __jsx(\"p\", null, \"PDP Controls\"), __jsx(Checkbox, {\n        label: \"Display on PDP\",\n        checked: isChecked,\n        onChange: function onChange() {\n          return updateMeta(data, isChecked, \"threekit\", \"pdp\", isPdp, handleSubmit);\n        },\n        onFocus: function onFocus() {\n          return isChecked ? setCheck(false) : setCheck(true);\n        }\n      }));\n    });\n  })), __jsx(Stack.Item, null, __jsx(Query, {\n    query: IS_AR_ENABLED,\n    variables: props.id,\n    onCompleted: function onCompleted(data) {\n      return setIsAr(data);\n    }\n  }, function (_ref6) {\n    var loading = _ref6.loading,\n        error = _ref6.error,\n        data = _ref6.data,\n        refetch = _ref6.refetch;\n    if (loading) return __jsx(LoadingText, null);\n    if (error) return \"Error! \".concat(error);\n    console.log(data);\n    return __jsx(Mutation, {\n      mutation: UPDATE_TK_ATTR,\n      onCompleted: function onCompleted() {\n        return setIsSaved(true);\n      }\n    }, function (handleArSubmit, _ref7) {\n      var err = _ref7.err,\n          res = _ref7.res;\n\n      var showError = err && __jsx(Banner, {\n        status: \"critical\"\n      }, err.message);\n\n      if (!data.product.metafield || data.product.metafield.value == \"false\") {\n        useEffect(function () {\n          setArChecked(false);\n        }, [setArChecked]);\n      } else {\n        useEffect(function () {\n          setArChecked(true);\n        }, [setArChecked]);\n      }\n\n      return __jsx(\"div\", null, __jsx(Checkbox, {\n        label: \"AR Enabled\",\n        checked: arChecked,\n        onChange: function onChange() {\n          return updateMeta(data, arChecked, \"threekit\", \"ARen\", isAr, handleArSubmit);\n        },\n        onFocus: function onFocus() {\n          return arChecked ? setArCheck(false) : setArCheck(true);\n        }\n      }));\n    });\n  }))))));\n}\n\nexport default ThreekitForm;","map":{"version":3,"sources":["/Users/willthompson/Documents/ThreeKit/Shopify/shopify-tutorial/components/ThreekitForm.js"],"names":["React","useState","useCallback","useEffect","Query","Mutation","gql","Banner","Form","FormLayout","Layout","TextField","Stack","TextStyle","Checkbox","Button","Toast","LoadingText","SnippetGen","ThreekitForm","props","value","setValue","tkMetaId","setTkMetaId","isSaved","setIsSaved","isPdp","setIsPdp","isChecked","setIsChecked","isAr","setIsAr","arChecked","setArChecked","modalActive","setModalActive","handleModalChange","UPDATE_TK_ID","GET_META_ID","IS_PLAYER_PDP","IS_AR_ENABLED","UPDATE_TK_ATTR","handleChange","newValue","setCheck","val","setArCheck","updateMeta","data","bool","namespace","key","obj","action","productVariableInput","product","metafield","id","metafields","valueType","variables","input","query","loading","error","refetch","title","handleSubmit","err","res","showError","message","console","log","handleArSubmit"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport { Query, Mutation } from \"react-apollo\";\nimport gql from \"graphql-tag\";\nimport {\n  Banner,\n  Form,\n  FormLayout,\n  Layout,\n  TextField,\n  Stack,\n  TextStyle,\n  Checkbox,\n  Button,\n  Toast,\n} from \"@shopify/polaris\";\nimport { LoadingText } from \"../components/Loading\";\nimport SnippetGen from \"../components/SnippetGen\";\n\nfunction ThreekitForm(props) {\n  // Declare a new state variable, which we'll call \"count\"\n  const [value, setValue] = useState(\"\");\n  const [tkMetaId, setTkMetaId] = useState();\n  const [isSaved, setIsSaved] = useState(false);\n\n  const [isPdp, setIsPdp] = useState({});\n  const [isChecked, setIsChecked] = useState(false);\n\n  const [isAr, setIsAr] = useState({});\n  const [arChecked, setArChecked] = useState(false);\n\n  const [modalActive, setModalActive] = useState(false);\n  const handleModalChange = useCallback(() => setModalActive(!modalActive), [\n    modalActive,\n  ]);\n\n  const UPDATE_TK_ID = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n\n  const GET_META_ID = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"assetid\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const IS_PLAYER_PDP = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"pdp\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const IS_AR_ENABLED = gql`\n    query($id: ID!) {\n      product(id: $id) {\n        metafield(namespace: \"threekit\", key: \"ARen\") {\n          value\n          id\n        }\n      }\n    }\n  `;\n\n  const UPDATE_TK_ATTR = gql`\n    mutation($input: ProductInput!) {\n      productUpdate(input: $input) {\n        product {\n          metafields(first: 100) {\n            edges {\n              node {\n                id\n                namespace\n                key\n                value\n              }\n            }\n          }\n        }\n      }\n    }\n  `;\n\n  const handleChange = useCallback((newValue) => setValue(newValue), []);\n\n  const setCheck = (val) => setIsChecked(val);\n  const setArCheck = (val) => setArChecked(val);\n\n  const updateMeta = (data, bool, namespace, key, obj, action) => {\n    let productVariableInput;\n    if (!data.product.metafield) {\n      bool\n        ? (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"false\",\n                valueType: \"STRING\",\n              },\n            ],\n          })\n        : (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"true\",\n                valueType: \"STRING\",\n              },\n            ],\n          });\n    } else {\n      bool\n        ? (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"false\",\n                valueType: \"STRING\",\n                id: obj.product.metafield.id,\n              },\n            ],\n          })\n        : (productVariableInput = {\n            id: props.id.id,\n            metafields: [\n              {\n                namespace: namespace,\n                key: key,\n                value: \"true\",\n                valueType: \"STRING\",\n                id: obj.product.metafield.id,\n              },\n            ],\n          });\n    }\n\n    action({\n      variables: {\n        input: productVariableInput,\n      },\n    });\n  };\n  return (\n    <div>\n      <Stack distribution=\"fill\">\n        <Form>\n          <FormLayout>\n            <Query query={props.query} variables={props.id}>\n              {({ loading, error, data, refetch }) => {\n                if (loading) return <LoadingText />;\n                if (error) return `Error! ${error}`;\n\n                return (\n                  <div>\n                    <Query\n                      query={GET_META_ID}\n                      variables={props.id}\n                      onCompleted={(data) => setTkMetaId(data)}\n                    >\n                      {({ loading, error, data, refetch }) => {\n                        if (loading) return null;\n                        if (error) return `Error! ${error}`;\n\n                        return null;\n                      }}\n                    </Query>\n\n                    <Stack.Item>\n                      <h3>\n                        <TextStyle variation=\"strong\">{props.title}</TextStyle>\n                      </h3>\n                    </Stack.Item>\n\n                    <Stack.Item>\n                      <Mutation\n                        mutation={UPDATE_TK_ID}\n                        onCompleted={() => setIsSaved(true)}\n                      >\n                        {(handleSubmit, { err, res }) => {\n                          const showError = err && (\n                            <Banner status=\"critical\">{err.message}</Banner>\n                          );\n\n                          return (\n                            <div>\n                              {!isSaved ? (\n                                <div></div>\n                              ) : (\n                                <Toast\n                                  content=\"Saved\"\n                                  onDismiss={() => setIsSaved(false)}\n                                ></Toast>\n                              )}\n\n                              <Layout.Section>{showError}</Layout.Section>\n\n                              <TextField\n                                value={value}\n                                onFocus={() =>\n                                  setValue(\n                                    !data.product.metafield\n                                      ? \"No Threekit ID\"\n                                      : data.product.metafield.value\n                                  )\n                                }\n                                onChange={handleChange}\n                                id={data.product.id}\n                                ariaControls={data.product.id}\n                                placeholder={\n                                  !data.product.metafield\n                                    ? \"No Threekit ID\"\n                                    : data.product.metafield.value\n                                }\n                                connectedRight={\n                                  <div>\n                                    <SnippetGen\n                                      handleChange={handleModalChange}\n                                      active={modalActive}\n                                      title={`${props.title}`}\n                                      assetid={\n                                        !data.product.metafield\n                                          ? \"No Threekit ID\"\n                                          : data.product.metafield.value\n                                      }\n                                      ar={\"true\"}\n                                      env={\"preview\"}\n                                    />\n                                    <Button\n                                      primary\n                                      onClick={() => {\n                                        let productVariableInput;\n                                        if (!data.product.metafield) {\n                                          productVariableInput = {\n                                            id: props.id.id,\n                                            metafields: [\n                                              {\n                                                namespace: \"threekit\",\n                                                key: \"assetid\",\n                                                value: value,\n                                                valueType: \"STRING\",\n                                              },\n                                            ],\n                                          };\n                                        } else {\n                                          productVariableInput = {\n                                            id: props.id.id,\n                                            metafields: [\n                                              {\n                                                namespace: \"threekit\",\n                                                key: \"assetid\",\n                                                value: value,\n                                                valueType: \"STRING\",\n                                                id:\n                                                  tkMetaId.product.metafield.id,\n                                              },\n                                            ],\n                                          };\n                                        }\n\n                                        handleSubmit({\n                                          variables: {\n                                            input: productVariableInput,\n                                          },\n                                        });\n                                      }}\n                                    >\n                                      Save\n                                    </Button>\n                                    <Button onClick={handleModalChange}>\n                                      Embed this product\n                                    </Button>\n                                  </div>\n                                }\n                              ></TextField>\n                            </div>\n                          );\n                        }}\n                      </Mutation>\n                    </Stack.Item>\n                  </div>\n                );\n              }}\n            </Query>\n\n            <Stack.Item>\n              <Query\n                query={IS_PLAYER_PDP}\n                variables={props.id}\n                onCompleted={(data) => setIsPdp(data)}\n              >\n                {({ loading, error, data, refetch }) => {\n                  if (loading) return <LoadingText />;\n                  if (error) return `Error! ${error}`;\n                  console.log(data);\n                  return (\n                    <Mutation\n                      mutation={UPDATE_TK_ATTR}\n                      onCompleted={() => setIsSaved(true)}\n                    >\n                      {(handleSubmit, { err, res }) => {\n                        const showError = err && (\n                          <Banner status=\"critical\">{err.message}</Banner>\n                        );\n                        if (\n                          !data.product.metafield ||\n                          data.product.metafield.value == \"false\"\n                        ) {\n                          useEffect(() => {\n                            setIsChecked(false);\n                          }, [setIsChecked]);\n                        } else {\n                          useEffect(() => {\n                            setIsChecked(true);\n                          }, [setIsChecked]);\n                        }\n\n                        return (\n                          <div>\n                            <p>\n                              PDP Controls\n                            </p>\n                            <Checkbox\n                              label=\"Display on PDP\"\n                              checked={isChecked}\n                              onChange={() =>\n                                updateMeta(\n                                  data,\n                                  isChecked,\n                                  \"threekit\",\n                                  \"pdp\",\n                                  isPdp,\n                                  handleSubmit\n                                )\n                              }\n                              onFocus={() =>\n                                isChecked ? setCheck(false) : setCheck(true)\n                              }\n                            />\n                          </div>\n                        );\n                      }}\n                    </Mutation>\n                  );\n                }}\n              </Query>\n            </Stack.Item>\n            <Stack.Item>\n              <Query\n                query={IS_AR_ENABLED}\n                variables={props.id}\n                onCompleted={(data) => setIsAr(data)}\n              >\n                {({ loading, error, data, refetch }) => {\n                  if (loading) return <LoadingText />;\n                  if (error) return `Error! ${error}`;\n                  console.log(data);\n                  return (\n                    <Mutation\n                      mutation={UPDATE_TK_ATTR}\n                      onCompleted={() => setIsSaved(true)}\n                    >\n                      {(handleArSubmit, { err, res }) => {\n                        const showError = err && (\n                          <Banner status=\"critical\">{err.message}</Banner>\n                        );\n                        if (\n                          !data.product.metafield ||\n                          data.product.metafield.value == \"false\"\n                        ) {\n                          useEffect(() => {\n                            setArChecked(false);\n                          }, [setArChecked]);\n                        } else {\n                          useEffect(() => {\n                            setArChecked(true);\n                          }, [setArChecked]);\n                        }\n\n                        return (\n                          <div>\n                            <Checkbox\n                              label=\"AR Enabled\"\n                              checked={arChecked}\n                              onChange={() =>\n                                updateMeta(\n                                  data,\n                                  arChecked,\n                                  \"threekit\",\n                                  \"ARen\",\n                                  isAr,\n                                  handleArSubmit\n                                )\n                              }\n                              onFocus={() =>\n                                arChecked ? setArCheck(false) : setArCheck(true)\n                              }\n                            />\n                          </div>\n                        );\n                      }}\n                    </Mutation>\n                  );\n                }}\n              </Query>\n            </Stack.Item>\n          </FormLayout>\n        </Form>\n      </Stack>\n    </div>\n  );\n}\n\nexport default ThreekitForm;\n"]},"metadata":{},"sourceType":"module"}